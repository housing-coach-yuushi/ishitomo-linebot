# トラッキング設定ガイド（LINE広告配信前の必須準備）

このガイドに従って、GA4とLINE Tagを設定することで、広告効果を正確に測定できます。

---

## 📊 STEP 1: Google Analytics 4 (GA4) のセットアップ

### 1-1. GA4アカウント作成（5分）

1. https://analytics.google.com/ にアクセス
2. 「測定を開始」をクリック
3. アカウント名を入力（例: `AI Perspective Bot`）
4. プロパティ名を入力（例: `AIパース作成くん`）
5. タイムゾーン: `日本`
6. 通貨: `日本円（JPY）`

### 1-2. 測定IDの取得

1. 管理 → データストリーム → ウェブ
2. ストリーム名: `Homepage`
3. ウェブサイトのURL: あなたのドメインを入力
   - 例: `https://ai-parse-line-bot.onrender.com`
4. 作成後、**測定ID** (`G-XXXXXXXXXX`) をコピー

### 1-3. HTMLファイルに測定IDを設定

`line_bot/homepage/index.html` の以下の箇所を編集:

```html
<!-- 変更前 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
    gtag('config', 'G-XXXXXXXXXX', {

<!-- 変更後（あなたの測定IDに置き換え）-->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ABC123DEF4"></script>
<script>
    gtag('config', 'G-ABC123DEF4', {
```

**2箇所とも**同じ測定IDに置き換えてください。

### 1-4. 動作確認

1. ローカルまたは本番環境でサイトを開く
2. ブラウザの開発者ツール（F12）→ Console を開く
3. エラーがないことを確認
4. GA4管理画面 → レポート → リアルタイム
5. 自分のアクセスが表示されればOK

---

## 📈 STEP 2: LINE Tag（コンバージョンタグ）のセットアップ

### 2-1. LINE広告アカウントにログイン

1. https://manager.line.biz/ にアクセス
2. LINE広告アカウントでログイン
3. 「ツール」→「コンバージョンコード」

### 2-2. コンバージョンを作成

1. 「新しいコンバージョンを作成」をクリック
2. 設定:
   - コンバージョン名: `友だち追加`
   - カテゴリ: `リード`
   - 測定期間: `30日`
   - 測定方法: `ウェブサイト`

### 2-3. LINE Tagコードを取得

1. コンバージョン作成後、「ベースコード」をコピー
2. `line_bot/homepage/index.html` の以下の箇所に貼り付け:

```html
<!-- LINE Tag (Conversion Tracking) -->
<script>
    // ここにLINE Tagのベースコードを貼り付け
    !function(e,i,t,n){
        // LINE広告管理画面からコピーしたコードをここに貼り付け
    }
</script>
```

### 2-4. コンバージョンイベントコードを設定

`line_bot/homepage/script.js` の以下の部分のコメントアウトを解除:

```javascript
// 変更前（コメントアウトされている）
// if (typeof _lt !== 'undefined') {
//     _lt('send', 'cv', {
//         type: eventName
//     });
// }

// 変更後（コメントアウトを解除）
if (typeof _lt !== 'undefined') {
    _lt('send', 'cv', {
        type: eventName
    });
}
```

### 2-5. 動作確認

1. サイトを開き、「LINEで友だち追加」ボタンをクリック
2. LINE広告管理画面 → ツール → コンバージョンコード
3. 「テストコンバージョン」が記録されていればOK

---

## 🔗 STEP 3: LINE友だち追加URLの設定

### 3-1. LINE公式アカウントの友だち追加URLを取得

1. LINE Official Account Manager にログイン
2. 「友だち追加」→「友だち追加ガイド」
3. **友だち追加URL** をコピー
   - 例: `https://line.me/R/ti/p/@abc1234`

### 3-2. HTMLに友だち追加URLを設定

`line_bot/homepage/script.js` の以下の箇所を編集:

```javascript
// 変更前
// TODO: Add actual LINE friend add URL
// window.open('https://line.me/R/ti/p/@YOUR_LINE_ID', '_blank');

// 変更後（あなたの友だち追加URLに置き換え）
window.open('https://line.me/R/ti/p/@abc1234', '_blank');
```

コメントアウト（`//`）を外して、URLを置き換えてください。

---

## 🎯 STEP 4: 広告キャンペーンの作成

### 4-1. LINE広告キャンペーン設定

1. LINE広告管理画面 → 「キャンペーン作成」
2. 設定:
   - キャンペーン目的: **友だち追加**
   - キャンペーン名: `テスト_1万円_202X年X月`
   - 予算: `10,000円`
   - 配信期間: 7日間

### 4-2. ターゲティング設定

```
年齢: 25-54歳
性別: 全体（または男性優先）
興味関心:
  - 不動産
  - 住宅
  - 建築
  - 営業・ビジネス
地域: 全国（または都市部のみ）
```

### 4-3. クリエイティブ準備

**画像:**
- サイズ: 1200x628px
- 内容: Before/Afterのスライダー画像
- テキストオーバーレイ: 「商談中にその場でパース作成」

**テキスト:**
```
【タイトル】
設計待ち時間ゼロ！商談中にその場でパース作成

【説明文】
住宅営業マン向け。LINEに写真を送るだけでAIが1分で高品質なパースを4枚生成。月3回まで無料でお試しいただけます。
```

**CTA:** 「詳しくはこちら」

### 4-4. リンク先URLにUTMパラメータを追加

広告のリンク先を以下のように設定:

```
https://あなたのドメイン.com/?utm_source=line&utm_medium=cpc&utm_campaign=test_10k_jan2024&utm_content=slide_image
```

UTMパラメータの説明:
- `utm_source=line`: 広告ソース（LINE）
- `utm_medium=cpc`: メディアタイプ（クリック課金）
- `utm_campaign=test_10k_jan2024`: キャンペーン名
- `utm_content=slide_image`: クリエイティブのバリエーション

---

## 📊 STEP 5: 測定データの確認

### 配信開始後にチェックすべき指標

#### GA4で確認:
1. **リアルタイム**
   - 現在のアクティブユーザー数
   - どのページを見ているか

2. **集客レポート**
   - セッション数
   - 新規ユーザー数
   - ソース（lineからの流入）

3. **エンゲージメントレポート**
   - イベント → `line_friend_add_click`
   - イベント → `scroll_depth`

4. **コンバージョン**
   - 「友だち追加」ボタンのクリック数

#### LINE広告管理画面で確認:
1. **インプレッション数**（表示回数）
2. **クリック数**
3. **クリック率（CTR）**
4. **クリック単価（CPC）**
5. **コンバージョン数**（友だち追加）
6. **コンバージョン単価（CPA）**

---

## 📈 目標数値（1万円テストの成功基準）

```
【成功の基準】
✅ 友だち追加単価: 300円以下
✅ クリック率(CTR): 1.5%以上
✅ 友だち追加後の利用率: 20%以上

【期待値】
予算: 10,000円
友だち追加単価: 200円
→ 友だち追加: 50人
→ 無料トライアル利用: 15人
→ 課金転換: 0-1人

【測定期間】
配信期間: 7日間
追跡期間: 配信後30日間（課金転換を測定するため）
```

---

## 🔧 トラブルシューティング

### GA4でデータが表示されない場合:

1. 測定ID（`G-XXXXXXXXXX`）が正しく設定されているか確認
2. ブラウザの広告ブロッカーを無効化
3. プライベートモードではなく通常モードでテスト
4. リアルタイムレポートで自分のアクセスが見えるか確認

### LINE Tagが動作しない場合:

1. LINE広告管理画面で「テストコンバージョン」を送信
2. ブラウザのコンソールでエラーがないか確認
3. `_lt` 関数が定義されているか確認:
   ```javascript
   console.log(typeof _lt); // "function" と表示されればOK
   ```

### 友だち追加URLが動作しない場合:

1. URLが正しいか確認（`https://line.me/R/ti/p/@` で始まっているか）
2. LINE公式アカウントが公開されているか確認
3. スマートフォンでテスト（PCでは開けないことがある）

---

## 📋 チェックリスト

配信前に以下を確認してください:

- [ ] GA4測定IDを設定済み
- [ ] GA4のリアルタイムレポートで自分のアクセスが見える
- [ ] LINE Tagベースコードを設置済み
- [ ] LINE Tagのテストコンバージョンが成功
- [ ] 友だち追加URLを設定済み
- [ ] 友だち追加URLが正しく動作する
- [ ] UTMパラメータ付きURLを広告に設定
- [ ] クリエイティブ（画像・テキスト）を準備済み
- [ ] ターゲティング設定を完了
- [ ] 予算と配信期間を設定

---

## 📞 サポート

設定で困った場合は、以下を確認してください:

1. **GA4ヘルプ**: https://support.google.com/analytics
2. **LINE広告ヘルプ**: https://www.linebiz.com/jp/service/line-ads/
3. **Chrome DevTools**: F12 → Console でエラーを確認

---

## 🚀 配信開始後のアクション

### 毎日チェック:
- LINE広告管理画面で配信状況を確認
- GA4で流入数を確認
- 予算消化ペースを確認

### 配信終了後:
1. 全データをスプレッドシートにまとめる
2. CPAを計算
3. 友だち追加→利用→課金の転換率を算出
4. 次回の改善ポイントを洗い出し

---

**重要:** トラッキングなしで広告を配信すると、1万円が無駄になります。
必ず上記の設定を完了してから広告配信を開始してください。
