<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°è¨­å®šãƒã‚§ãƒƒã‚¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #06c656;
            margin-bottom: 10px;
        }
        .status {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: 500;
        }
        .status.success {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        .status.warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        .icon {
            font-size: 24px;
            margin-right: 15px;
        }
        button {
            background-color: #06c656;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
        }
        button:hover {
            background-color: #05a849;
        }
        .details {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
        }
        .guide {
            background-color: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .guide-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ“Š ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°è¨­å®šãƒã‚§ãƒƒã‚¯</h1>
        <p>LINEåºƒå‘Šé…ä¿¡å‰ã«ã€å¿…è¦ãªãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</p>
        <button onclick="runCheck()">ãƒã‚§ãƒƒã‚¯é–‹å§‹</button>

        <div id="results" style="margin-top: 20px;"></div>
    </div>

    <script>
        function runCheck() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>ãƒã‚§ãƒƒã‚¯ä¸­...</p>';

            let html = '';
            let allPassed = true;

            // Check 1: Google Analytics
            if (typeof gtag !== 'undefined') {
                html += createStatus('success', 'Google Analytics (GA4) ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ âœ“');

                // Check if GA4 ID is configured
                const scripts = document.querySelectorAll('script[src*="googletagmanager"]');
                let gaId = 'G-XXXXXXXXXX';
                scripts.forEach(script => {
                    const match = script.src.match(/id=(G-[A-Z0-9]+)/);
                    if (match) gaId = match[1];
                });

                if (gaId === 'G-XXXXXXXXXX') {
                    html += createStatus('error', 'æ¸¬å®šIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚TRACKING_SETUP.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚');
                    allPassed = false;
                } else {
                    html += createStatus('success', `æ¸¬å®šID: ${gaId}`);
                }
            } else {
                html += createStatus('error', 'Google Analytics (GA4) ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                allPassed = false;
            }

            // Check 2: LINE Tag
            if (typeof _lt !== 'undefined') {
                html += createStatus('success', 'LINE Tag ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ âœ“');
            } else {
                html += createStatus('warning', 'LINE Tag ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸï¼ˆåºƒå‘Šé…ä¿¡æ™‚ã«è¨­å®šã—ã¦ãã ã•ã„ï¼‰');
            }

            // Check 3: Event Tracking
            const testButton = document.createElement('button');
            testButton.textContent = 'LINEã§å‹ã ã¡è¿½åŠ ï¼ˆãƒ†ã‚¹ãƒˆï¼‰';
            testButton.style.display = 'none';
            document.body.appendChild(testButton);

            let eventTracked = false;
            const originalGtag = window.gtag;
            window.gtag = function() {
                eventTracked = true;
                if (originalGtag) originalGtag.apply(window, arguments);
            };

            testButton.click();
            document.body.removeChild(testButton);

            window.gtag = originalGtag;

            if (eventTracked) {
                html += createStatus('success', 'ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãŒå‹•ä½œã—ã¦ã„ã¾ã™ âœ“');
            } else {
                html += createStatus('error', 'ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãŒå‹•ä½œã—ã¦ã„ã¾ã›ã‚“');
                allPassed = false;
            }

            // Check 4: LINE Friend Add URL
            const scriptContent = document.documentElement.innerHTML;
            if (scriptContent.includes('line.me/R/ti/p/@')) {
                if (scriptContent.includes('@YOUR_LINE_ID')) {
                    html += createStatus('error', 'å‹ã ã¡è¿½åŠ URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆ@YOUR_LINE_ID ã®ã¾ã¾ï¼‰');
                    allPassed = false;
                } else {
                    html += createStatus('success', 'å‹ã ã¡è¿½åŠ URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ âœ“');
                }
            } else {
                html += createStatus('warning', 'å‹ã ã¡è¿½åŠ URLã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
            }

            // Check 5: UTM Parameters Support
            const currentUrl = new URL(window.location.href);
            const utmSource = currentUrl.searchParams.get('utm_source');
            const utmMedium = currentUrl.searchParams.get('utm_medium');
            const utmCampaign = currentUrl.searchParams.get('utm_campaign');

            if (utmSource || utmMedium || utmCampaign) {
                html += createStatus('success', `UTMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ: source=${utmSource || 'ãªã—'}, medium=${utmMedium || 'ãªã—'}, campaign=${utmCampaign || 'ãªã—'}`);
            } else {
                html += createStatus('warning', 'UTMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸï¼ˆåºƒå‘ŠURLã«è¿½åŠ ã—ã¦ãã ã•ã„ï¼‰');
            }

            // Summary
            if (allPassed) {
                html += '<div class="guide"><div class="guide-title">âœ… ã™ã¹ã¦ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸ</div>';
                html += '<p>LINEåºƒå‘Šã‚’é…ä¿¡ã™ã‚‹æº–å‚™ãŒã§ãã¦ã„ã¾ã™ã€‚TRACKING_SETUP.md ã‚’å‚ç…§ã—ã¦åºƒå‘Šã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p></div>';
            } else {
                html += '<div class="guide" style="background-color: #fff3cd; border-left-color: #ffc107;"><div class="guide-title" style="color: #856404;">âš ï¸ è¨­å®šãŒä¸å®Œå…¨ã§ã™</div>';
                html += '<p>TRACKING_SETUP.md ã‚’å‚ç…§ã—ã¦ã€ã‚¨ãƒ©ãƒ¼é …ç›®ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚ã“ã®ã¾ã¾åºƒå‘Šã‚’é…ä¿¡ã™ã‚‹ã¨åŠ¹æœæ¸¬å®šãŒã§ãã¾ã›ã‚“ã€‚</p></div>';
            }

            // Console test
            html += '<div class="details"><strong>ãƒ‡ãƒãƒƒã‚°æƒ…å ±:</strong><br>';
            html += `GA4: ${typeof gtag !== 'undefined' ? 'OK' : 'NG'}<br>`;
            html += `LINE Tag: ${typeof _lt !== 'undefined' ? 'OK' : 'Not configured'}<br>`;
            html += `URL: ${window.location.href}<br>`;
            html += `User Agent: ${navigator.userAgent}</div>`;

            results.innerHTML = html;

            // Send test event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'tracking_check', {
                    'all_passed': allPassed
                });
            }
        }

        function createStatus(type, message) {
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸'
            };
            return `<div class="status ${type}"><span class="icon">${icons[type]}</span><span>${message}</span></div>`;
        }

        // Auto-run on page load
        window.addEventListener('load', function() {
            setTimeout(runCheck, 500);
        });
    </script>
</body>
</html>
